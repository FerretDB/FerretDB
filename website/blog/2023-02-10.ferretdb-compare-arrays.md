---
title: "How MongoDB compares arrays"
slug: ferretdb-compare-arrays
authors: [chi tag]
description: Find out how arrays are compared at FerretDB.
keywords:
  - keyword1
  - keyword2
image: /img/blog/ferretdb-how-mongodb-compares-arrays.jpg
tags: [tag1, tag2]
unlisted: true
---

Find out how arrays are compared at FerretDB.

![Image alt description](/img/blog/ferretdb-how-mongodb-compares-arrays.jpg)

<!--truncate-->

## BSON Comparison Order

Different BSON values are have comparison order from the lowest to the highest as it's listed in following.
It's documented in [MongoDB Comparison/Sort Order](https://www.mongodb.com/docs/manual/reference/bson-type-comparison-order/).

1. Null
2. Numbers (ints, longs, doubles, decimals)
3. Symbol, String
4. Object
5. Array
6. BinData
7. ObjectId
8. Boolean
9. Date
10. Timestamp
11. Regular Expression

For comparison of BSON, we first use comparison order, when it's the same, the comparison specific to that type is used.
When the BSON types are different, they use above comparison order.
For example, `a` is greater than `1` using comparison order.
When the BSON types are the same, they use comparison implemented specifically for that type.
For example, `12` is greater than `3.5` by number comparison.
## How array is compared

Array is no other exception when we are comparing two arrays.
It checks if element exists in that index, then comparison order of the index and compares values when they are the same BSON type.

Array compares each element of the array.
For example comparing `[3, 1, 'b']` and `[3, 2, 'a']` takes following steps.
1. Check `[3, 1, 'b']` and `[3, 2, 'a']` for comparison order. They are both arrays.
2. Check first index comparison order, they are both numbers.
3. Compare first index numbers `3` and `3`, they are the same.
4. Check next index, `1` is number and less than string `b` in comparison order.
So `[3, 1, 'b']` is less than `[3, 'b', 'a']`.

If an array has no more element to compare, the one which has more element is greater.
For example comparing `[3, 1]` and `[3]` takes following steps.
1. Check `[3, 1]` and `[3]` for comparison order. They are both arrays.
2. Check first index comparison order, they are both numbers.
3. Compare first index numbers `3` and `3`, they are the same.
4. Check next index, first array has `1` but second array does not have any element.
If one array no longer has index to compare, that array is less.
So `[3, 1]` is greater than `[3]`.

For the same reason empty array is less than other arrays.

# How array is compared with other BSON types
When we compare array with other BSON types, it doesn't _always_ use comparison order.
I will describe the case it does use comparison order in [$max and $min update operator](#max-min-update-operator).
For many cases, array uses an element inside an array to compare with other BSON type.
For example, comparing `2` and `[3, 1]` the result is different based on ascending sort or descending sort.

Let's use ascending sort to compare `2` and `[3, 1]`.
1. It gets the smallest element of array `[3, 1]` which is `1`
2. It compares `2` and `1` and `1` is less.
So `[3, 1]` is less than `2`.

Let's use descending sort to compare `2` and `[3, 1]`.
1. It gets the largest element of array `[3, 1]` which is `3`
2. It compares `2` and `3`, `3` is greater.
So `[3, 1]` is greater than `2`.

It might seem confusing at first, but ascending sort uses the smallest element from the array and
descending sort uses the largest element from the array.

For an empty array, it's smaller than any BSON type. So `[]` is smaller than even `null`.

#### sorting
Sorting is applied to result to return them in ascending or descending comparison order.
For ascending sort indicated by `1`, the largest element of the array is used for comparison.
`db.collections.find({}).sort({<<field>>: 1})`

Let's look at how ascending sort orders elements.
```
[]          // empty array is the smallest in BSON.
null
[0 'a' 'z'] // uses smallest element 0
[10 5]      // uses smallest element 5
['a']       // uses smallest element `a`
'b'
```

For descending sort, the largest element of the array is used for comparison.
`db.collections.find({}).sort({<<field>>: -1})`

Let's look at how descending sort orders elements.
```
[0 'a' 'z'] // uses largest element `z`
'b'
['a']       // uses largest element `a`
[10 5]      // uses largest element 10
null
[]
```

Take a note that descending sort is not opposite order of ascending sort when array is being used.

#### $gt and $lt filter operators
#### $max and $min update operators {#max-min-update-operator}
[$max and $min](https://docs.ferretdb.io/basic_operations/read/#retrieve-documents-using-operator-queries) operators
compares the array element of the same type.
## Array within array comparison - nested array
Nested array is similar to an array for comparison.

For example, comparing empty nested array `[[1 'b']]` and `[['a' 2] ['c']]`.
1. Check comparison order of `[[1 'b']]` and `[['a' 2] ['c']]`, they are both array.
2. Check comparison order of the first index `[1 'b']` and `['a' 2]`, they are both array.
3. Check comparison order of the first index within the nested array `1` and `a`, `1` is number and `a` is string. The number is smaller in comparison order.
So `[[1 'b']]` is less than `[['a' 2] ['c']]`.

The empty nested array behaves just like other array type.
For example, comparing empty nested array `[null]` and `[[]]`.
1. It checks comparison order of  `[null]` and `[[]]`, they are both array.
2. It checks comparison order of the first element `null` and `[]`, null is less than array in comparison order.
So `[null]` is less than `[[]]`.

Unlike an array comparison where `[]` was less than `null`, nested array considers comparison order of
null and array, where array has greater comparison order.

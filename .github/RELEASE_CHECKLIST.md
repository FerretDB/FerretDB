# Release Checklist

## Preparation

1. [Release DocumentDB](https://github.com/FerretDB/documentdb/blob/ferretdb/.github/RELEASE_CHECKLIST.md).
2. Update constants in [`documentdb.go`](../build/version/documentdb.go).
3. Update DocumentDB image tags to point to release in:
   - [evaluation image](../build/ferretdb/evaluation.Dockerfile);
   - [local image](../build/deps/postgres-documentdb.Dockerfile).
4. Check DocumentDB images tags in documentation (where we specify full tags).
5. Re-run tests, linters.
6. Check issues and pull requests, update milestones and labels.
7. Check if there are breaking changes or anything that should be reflected in the changelog and/or user documentation.
8. Create draft release on GitHub with autogenerated release notes.
9. Generate changelog:
   - Run `task changelog MILESTONE_TITLE=vX.Y.Z PREVIOUS_MILESTONE_TITLE=vX.Y.Z`
     to generate release changelog for the given milestone.
   - Copy the changelog to the `CHANGELOG.md` file.
   - Sort items within sections according to importance if needed.
   - Add first-time contributor credits if any (copy this data from the release draft).
   - Add link to DocumentDB release page.
10. Run `task docs-version VERSION=X.Y`.
    Update `versions` in `docusaurus.config.js`.
    Remove the oldest version from `versioned_docs`, `versioned_sidebars`, `versions.json`.
11. Run `task docs-fmt`.
12. Commit and push changes to the PR.
13. Merge PR, pull and check `git status`.

## Git tag

1. Make a signed tag `vX.Y.Z` with the relevant section of the changelog using `--cleanup=verbatim`.
2. Check `task gen-version; git status` output.
3. Push it!
4. Refresh
   - `env GOPROXY=https://proxy.golang.org go mod download -x github.com/FerretDB/FerretDB/v2@<vX.Y.Z>`
   - `https://pkg.go.dev/github.com/FerretDB/FerretDB/v2@<vX.Y.Z>` from https://pkg.go.dev/github.com/FerretDB/FerretDB/v2?tab=versions.

## Release

1. Copy release notes from `CHANGELOG.md` and trim them.
2. Wait for the [packages CI build](https://github.com/FerretDB/FerretDB/actions/workflows/packages.yml?query=event%3Apush)
   to finish.
3. Upload binaries and packages to the draft release.
4. Check:
   - https://hub.docker.com/r/ferretdb/ferretdb/tags
   - https://hub.docker.com/r/ferretdb/ferretdb-dev/tags
   - https://hub.docker.com/r/ferretdb/ferretdb-eval/tags
   - https://github.com/FerretDB/FerretDB/pkgs/container/ferretdb
   - https://github.com/FerretDB/FerretDB/pkgs/container/ferretdb-dev
   - https://github.com/FerretDB/FerretDB/pkgs/container/ferretdb-eval
   - https://quay.io/repository/ferretdb/ferretdb?tab=tags
   - https://quay.io/repository/ferretdb/ferretdb-dev?tab=tags
   - https://quay.io/repository/ferretdb/ferretdb-eval?tab=tags
5. Close milestone in issues.
6. Publish release on GitHub.
7. Announce it on Slack.

## Soon after

1. Publish and announce blog post.
2. Add link to blog post to `CHANGELOG.md` and release page.
3. Bump the latest version on https://beacon.ferretdb.com and https://beacon.ferretdb.io.
4. Update DocumentDB image tags to point back to development version.
5. Update DocumentDB images tags in the current documentation (where we specify full tags)
   to point to the next (non-existing) version.

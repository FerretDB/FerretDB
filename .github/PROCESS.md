# The Process

This file contains some process notes for FerretDB Inc. engineers and long-term contributors.
If you are a community contributor, feel free to ignore all this!
We will do all that for you so you can focus on what is really interesting for you.

This guide tries to be short and does not mention things that are completely automated by our tooling.

## Team performance and planning

We want to deliver fast and make our deliverables predictable.
To achieve that, we measure the flow of work and estimate tasks.
The flow of work is measured automatically based on GitHub's pull request workflow.
Tasks are estimated manually by engineers before or during Sprint planning.

Task estimation depends on the following parameters:

* Scope.
  Are the changes required in one or multiple files, packages, components?
* Difficulty.
  How hard is the task?
  Does it require to cover a lot of test cases?
  edge cases?
* Clarity.
  Are the description and definition of done clear?
  Or that's more of a research task?

We use the following T-Shirt Sizes to estimate tasks:

* **S**: Small simple clear task.
* **M**: Only one parameter can be changed compared to **S** (e.g. a small but not completely clear task).
* **L**: Two parameters can be changed compared to **S** (e.g. clear but big and somewhat complex task).

If the team thinks that the task is bigger than **L**, it should be decomposed into smaller tasks.

Unless the issue explicitly states otherwise, the following things are always in the scope:

* Tests.
  See contributing documentation for general discussion about unit and integration tests.
* Small spot refactorings.
  Larger refactorings should be in a separate issue with minimal behavior changes.
* Minor updates to existing documentation.
  Completely new documentation should be in a separate issue.

Words "small", "spot", "larger", "minimal", "minor" and similar are defined to be not clearly defined.
As always, use your best judgment and communicate (preferably on the planning).

Engineering tasks could be added to the Sprint only if there are no other pre-planned tasks that are not done
or could not benefit from more help.
Those tasks should not be estimated.

After every Sprint, we calculate how many tasks of each size we were able to complete
and discuss what went well and what could be improved.
We also look at the flows' metrics to gather more information about the team's dynamic.

Estimation mistakes should be an exception, not a norm.
Try to estimate on the planning as best as you can.

## Pull requests

1. Send pull requests from forks; do not make personal branches in the main repository.
   This way, we are similar to community members and could notice similar problems that we could fix for everyone,
   not just for us.
2. Pull request **title** should be accurate and descriptive as it is used in the generated changelog.
   It should not mention the issue number but describe the fixed issue instead.
3. Most of the time pull requests are related to some issues.
   In such cases, pull request **description** should mention the issue number like `Closes #{issue_number}.`.
   Do not use URLs like `https://github.com/org/repo/issue/123` even if they are rendered the same on GitHub.
   If you propose a tiny fix, there is no needed to create a new issue.
4. We provide a pull requests template that includes suggestions and readiness checklist.
   Please use it.
5. It is fine to send several sequential pull requests for one issue to make them easier to review.
   In that case, please still use the `Closes #{issue_number}.` phrase
   (as [words like "refs" do not link PR to the issue](https://docs.github.com/en/issues/tracking-your-work-with-issues/linking-a-pull-request-to-an-issue#linking-a-pull-request-to-an-issue-using-a-keyword)),
   but don't forget to reopen the issue once PR is merged,
   but the issue as a whole is not done.
6. Please create a draft pull request as soon as you start working on an issue; that is needed for our process tooling.
   Once it is ready for review, please mark it as such.
   After that, there is no need to switch between draft and non-draft states.
7. In the pull request review conversations, please either leave a new comment or resolve (close) the conversation,
   but do not do that simultaneously.
   That ensures that the other person can read all comments.
8. Please don't forget to click "re-request review" buttons once PR is ready for re-review.
9. Commit messages (both titles and bodies) are not important and can be "WIP" or anything else.
   All commits are always squashed on merge by GitHub, so there is no need to squash them manually, amend them, and/or do force pushes.
   Autogenerated GitHub's squash commit's body should be manually replaced by "Closes #{issue_number}.".
   Do not leave original commit messages in the squashed commit body.
10. Pull requests are typically merged by an auto-merge that the author should enable.
    It can also be merged by the reviewer if branch protection rules and CI checks allow that.
    If the pull request is not ready to be merged for some reason (but ready to be reviewed as usual),
    the description should explain why, and the `do not merge` label should be applied.
11. Ultimately, the author is responsible for doing everything to ensure that the pull request is merged and done.

One can see all pull requests that await review [there](https://github.com/pulls/review-requested?q=user%3AFerretDB+is%3Aopen).
We also have [#devlog channel](https://ferretdb.slack.com/archives/C02P0MR7VJS)
in our community Slack with periodic reminders.
To make them useful,
talk with [@GitHub bot in direct messages](https://ferretdb.slack.com/archives/D02P4EJPFGV)
to link your Slack and GitHub identities,
and then configure notification only for your name.
